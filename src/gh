#!/bin/bash
source "$HOME/.local/bin/git-suite-lib.sh"
CFG="$HOME/.config/git-suite/favorites"
ALIAS_MAP="$HOME/.config/git-suite/aliases.conf"

if [[ "$1" == "-a" ]]; then
    [ -z "$2" ] && echo "Usage: gh -a <alias> <desc> [cmd]" && exit 1
    echo "$2|$3|$4" >> "$CFG"
    echo "${C_SUCCESS}Added favorite '$2'${RESET}"; exit 0
fi

ui_header "GIT DASHBOARD" "My Suite"
fmt=" %-8s ${C_MUTED}|${RESET} %-30s ${C_MUTED}|${RESET} %s\n"

get_alias() {
    local tool="$1"; local default="$2"
    if [ -f "$ALIAS_MAP" ]; then
        found=$(grep "$tool" "$ALIAS_MAP" | cut -d'|' -f1 | head -n1)
        echo "${found:-$default}"
    else echo "$default"; fi
}

printf "${C_MAIN}${BOLD} SUITE TOOLS${RESET}\n"
printf "$fmt" "$(get_alias "rsw" "gps")" "Repo Manager" "Project Switcher"
printf "$fmt" "$(get_alias "gsw" "gsw")" "Branch Manager" "Smart Switch"
printf "$fmt" "$(get_alias "gac" "gcw")" "Smart Commit" "Wizard"
printf "$fmt" "$(get_alias "gpp" "gup")" "Push & PR" "Auto-Opener"
printf "$fmt" "gset" "Settings" "${BOLD}Customize Suite${RESET}"

printf "\n${C_WARN}${BOLD} FAVORITES${RESET}\n"
[ -f "$CFG" ] && while IFS='|' read -r cmd desc full; do
    [ -n "$cmd" ] && printf "$fmt" "$cmd" "$desc" "${full:-$cmd}"
done < "$CFG"