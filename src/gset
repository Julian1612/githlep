#!/bin/bash
source "$HOME/.local/bin/git-suite-lib.sh"
CONF_DIR="$HOME/.config/git-suite"
ALIAS_CONF="$CONF_DIR/aliases.conf"
LOADER="$CONF_DIR/loader.sh"
SETTINGS="$CONF_DIR/settings.conf"
mkdir -p "$CONF_DIR"; touch "$SETTINGS"

update_loader() {
    echo "# GIT SUITE LOADER" > "$LOADER"
    echo "export PATH=\"\$HOME/.local/bin:\$PATH\"" >> "$LOADER"
    [ -f "$SETTINGS" ] && cat "$SETTINGS" >> "$LOADER"
    if [ -f "$ALIAS_CONF" ]; then
        while IFS='|' read -r short name cmd; do
            [[ "$short" =~ ^# || -z "$short" ]] && continue
            echo "unalias $short >/dev/null 2>&1" >> "$LOADER"
            echo "alias $short='$cmd'" >> "$LOADER"
        done < "$ALIAS_CONF"
    fi
    chmod +x "$LOADER"
    echo "${C_GREEN}âœ” Reloaded.${RESET}"
}

while true; do
    ui_header "SETTINGS" "Control Center"
    echo "  ${C_ACCENT}1)${RESET} Repair Aliases (Reload)"
    echo "  ${C_ACCENT}2)${RESET} Edit Aliases"
    echo "  ${C_ACCENT}3)${RESET} Set Editor"
    echo "  ${C_ACCENT}4)${RESET} Git User"
    echo "  ${C_ACCENT}q)${RESET} Quit"
    printf "\nSelect: "; read -rsn1 key
    case "$key" in
        1) tput cnorm; echo ""; update_loader; sleep 1; tput civis ;;
        2) tput cnorm; ${GIT_EDITOR:-nano} "$ALIAS_CONF"; update_loader; tput civis ;;
        3) ui_input "Editor:"; [ -n "$VAL" ] && echo "export GIT_EDITOR='$VAL'" > "$SETTINGS";;
        4) ui_input "Name:"; [ -n "$VAL" ] && git config --global user.name "$VAL";
           ui_input "Email:"; [ -n "$VAL" ] && git config --global user.email "$VAL" ;;
        q) exit 0 ;;
    esac
done
